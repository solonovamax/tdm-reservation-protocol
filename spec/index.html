<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
	<head>
		<meta charset="utf-8" />
		<title>TDM Reservation Protocol (TDMRep)</title>
		<script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove"  defer></script>
    <script src="common/js/biblio.js" class="remove"></script>
		<script src="common/js/orcid.js" class="remove"></script>
		<script src="common/js/wp.js" class="remove"></script>
		<link href="common/css/common.css" rel="stylesheet" type="text/css" />
		<script class="remove">
          var respecConfig = {
              group: "tdmrep",
              shortName: "tdmrep",
              specStatus: "CG-DRAFT",
              noRecTrack: true,
              copyrightStart: "2021",
              editors: [
              	{
              		name: "Laurent Le Meur",
              		company: "EDRLab",
              		companyURL: "https://www.edrlab.org",
									"w3cid": 91888
              	}
              ],
              formerEditors: [
              ],
              wgPublicList: "public-tdmrep",
							github: "https://github.com/w3c/tdm-reservation-protocol"
          };
      </script>
	</head>
	<body>

		<section id="abstract">
			<p>This specification defines a simple and practical Web protocol, capable of expressing the reservation of rights relative to text & data mining (TDM) applied to lawfully accessible Web content, and to ease the discovery of TDM licensing policies associated with such content.</p>
      <p>This initiative is a technical answer to the constraints set by the Article 4 of the new Digital Single Market European Directive.</p>
		</section>

		<section class="informative" id="sotd">
		</section>

		<section class="informative" id="sec-introduction">
			<h1>Introduction</h1>
      <p>In addition to their significance in the context of scientific research, text and data mining techniques (TDM) are widely used both by private and public entities to analyse large amounts of data (including copyright protected content like text, images, video etc.) in different areas of life and for various purposes, including for government services, complex business decisions and the development of new applications or technologies.</p>

      <p>In a digital environment, TDM usage of copyright protected works can be subject to different terms and conditions, depending on the legal framework. In generic terms, an act of reproduction is required before TDM can be applied on content accessible on the Web; international laws stipulate that such act of reproduction is subject to authorization by rightsholders. So far, analyzing and processing the terms and conditions of a website, contacting rightsholders, seeking for permission and concluding licensing agreements require time and resources.</p>

      <p>In such context, a machine-readable solution which streamlines the communication of TDM rights and licenses available for online copyrighted content is necessary to facilitate the development of TDM applications and reduce the risks of legal uncertainty for TDM actors. Such a solution, that shall rely on a consensus by rightsholders and TDM actors, will optimize the capacity of TDM actors to lawfully access and process useful content at large scale.</p>

      <p>The Directive on copyright and related rights in the Digital Single Market or [EU Directive 2019/790](https://eur-lex.europa.eu/legal-content/EN/TXT/HTML/?uri=CELEX:32019L0790&from=EN), better known as the "DSM Directive" (DSM meaning Digital Single Market), introduces two exceptions or limitations to the rights of rightsholders on lawfully accessible content, for reproductions and extractions for the purposes of TDM:</p>

      <p>In its Article 3, a mandatory exception for research organisations and cultural heritage institutions which carry out TDM for the purposes of scientific research.</p>

      <p>In its Article 4, an exception for any organisation willing to carry out TDM  for any purpose other than scientific research, including commercial purposes, which applies on the condition that the use of content for TDM has not been expressly reserved by their rights holders in an appropriate manner, such as machine-readable means.</p>

      <p>These TDM exceptions apply to TDM usage in the European Union in relation to content from European and foreign rightsholders. Outside of the EU, where the DSM legislation does not apply, the said exception does not apply: exclusive rights of right-holders to authorize acts of reproduction are maintained. In such cases, no TDM can be performed without the explicit authorisation of these rightsholders: in these countries, the absence of a reservation of rights by rightsholders cannot be considered as an implicit authorization to reproduce copyrighted content for TDM purpose, and advocating fair use or a similar rule is legally uncertain, as these actions are judged on a case-per-case basis.</p>

      <p>The “opt-out” mechanism introduced by the DSM Directive is therefore a real opportunity for TDM actors and publishers across countries to define a machine-readable technique able to express not only if TDM rights on specific Web content are reserved or not, but also how rightsholders can be contacted and which licenses are available, if any. This is a tremendous help for TDM actors from all countries looking for legal certainty.</p>
		</section>

		<section class="informative" id="sec-terminology">
			<h1>Terminology</h1>

			<dl class="termlist">
				<dt><dfn id="dfn-rightsholder">Rightsholder</dfn></dt>
				<dd>
					<p>Person or organization that owns the legal rights to something, in our case Web resources ([Wiktionary](https://en.wiktionary.org/wiki/rightsholder)).</p>
				</dd>
				<dt><dfn id="dfn-publisher"></dfn>Publisher</dt>
				<dd>
					<p>Person or organization that makes Web resources available to the public..</p>
				</dd>
				<dt><dfn id="dfn-tdm-actor" data-lt="TDM Actors">TDM Actor</dfn></dt>
				<dd>
					<p>Person or organization practicing TDM (on Web resources in our case).</p>
				</dd>
				<dt><dfn id="dfn-tdm-agent">TDM Agent</dfn></dt>
				<dd>
					<p>Software accessing Web resources for TDM purposes.</p>
				</dd>
				<dt><dfn id="dfn-tdm-license">TDM License</dfn></dt>
				<dd>
					<p>Description of the terms and conditions by which a TDM actor can process a given Web resource. </p>
				</dd>
				<dt><dfn id="dfn-tdm-policy">TDM Policy</dfn></dt>
				<dd>
					<p>Description of the kind of TDM Licenses a TDM Actor may obtain from a rightsholder. </p>
				</dd>
				<dt><dfn id="dfn-tdm-rights"></dfn>TDM Rights</dt>
				<dd>
					<p>Rights to process a Web resource via TDM techniques, for a certain purpose (e.g commercial / research).</p>
				</dd>
				<dt><dfn id="dfn-web-resource"></dfn>Web Resource</dt>
				<dd>
					<p>Identifiable thing available on the Web ([Wikipedia](https://en.wikipedia.org/wiki/Web_resource)). Web resources are located using URLs.</p>
				</dd>
				<dt><dfn id="dfn-web-page"></dfn>Web page</dt>
				<dd>
					<p>Web resource formatted in HTML.</p>
				</dd>
			</dl>

		</section>

		<section class="informative" id="conformance">
			<!-- boilerplate will be added here -->
		</section>

		<section class="informative" id="sec-requirements">

				<h1>Requirements</h1>

				<p>The technical specification shall:</p>

        <ul>
          <li>Specify how a rightsholder can declare the reservation of TDM Rights on each individual Web resource he controls.</li>
          <li>Specify how a rightsholder can indicate the location of a TDM Policy associated with each individual Web resource he controls.</li>
          <li>Specify a machine-readable format for TDM Policies.</li>
      </ul>

		</section>

		<section id="sec-properties">

				<h1>Expressing a TDM Declaration</h1>

				<p>The goal of this protocol is to allow a rightsholder to declare his choice regarding text & data mininig of Web resources he controls, thereby allowing recipients of that declaration to adjust their scraping behavior accordingly or to reach a separate agreement with the rightsholder that satisfies all parties.</p>

        <p>Such a preference is expressed via two complementary properties:</p>

        <h2>TDM-a</h2>

        <p>TDM-a is an integer.</p>
        
        <table class="simple">
          <tr><th>TDM-a</th>
              <th>meaning</th>
          </tr>
          <tr><td>unset</td>
              <td>The rightsholder's choice is not declared. For TDM usage in Europe, a TDM agent can mine this content for TDM purposes without having to contact the rightsholder. For TDM usages outside of Europe, a TDM actor must contact the rightsholder and request an authorization to mine the content.</td>
          </tr>
          <tr><td>0</td>
              <td>TDM rights are not reserved. TDM agents can mine this content for TDM purposes without having to contact the rightsholder, regardless where the TDM usage is taking place.</td>
          </tr>
          <tr><td>1</td>
              <td>TDM rights are reserved. This is the "opt-out" option specified by the Article 4 of the DSM. TDM Agents shall not mine this content, regardless where the TDM usage is taking place.</td>
          </tr>
          <tr><td>2</td>
              <td>TDM rights are reserved and a TDM Policy is available. TDM Agents can use TDM-b to ease contact with the rightsholder and request an authorization to mine the content.</td>
          </tr>
        </table>

        <p>Other values are considered protocol errors. In such a case the TDM Agents MUST consider that the value of TDM-a is <code>unset</code>.</p>

        <h2>TDM-b</h2>
        
        <p>TDM-b is a URL.</p>
        
        <p>TDM-b SHOULD be set only if the value of TDM-a is <code>2</code>.</p>
        <p>The absence of TDM-b if the value of TDM-a is <code>2</code> is considered a protocol error. In such a case TDM Agents MUST consider that the value of TDM-a is <code>1</code>.</p>

        <p>If the Web resource located at this URL is a Web page (i.e. its content-type is <code>text/html</code>), this resource is considered human readable.</p>
        <p>If it has the content-type of the TDM Policy (i.e. its content-type is <code>application/ld+json</code>), this Web resource is considered machine-readable.</p>
        <p>Other content-types are considered protocol errors. In such a case TDM Agents MUST consider that the value of TDM-a is <code>1</code>.</p>

				<div class="note">
          <p>The presence of TDM-b if the value of TDM-a is not <code>2</code> is not considered a protocol error. TDM Agents simply don't process TDM-b in this case.</p>
        </div>

		</section>

		<section id="sec-protocol">

      <h1>Protocol</h1>

      <p>This specification provides three complementary techniques for expressing rightsholders' choices. These three techniques correspond to different situations and publishers' technical skills.</p>

      <section id="sec-tdm-file">

        <h2>TDM File on the Origin Server</h2>

        <p>The TDM file on the origin server is a mechanism for declaring site-wide righsholder's choices in a file hosted on the origin server of the Web content a TDM Agent wishes to mine.</p>
        <p>A TDM Agent MUST check the presence of this file before it starts scraping the content of a Web server.</p>

        <p>An origin server that receives a valid GET request targeting this resource MUST send either a successful response containing a machine-readable representation of the site-wide righsholder's choices, as defined below, or a sequence of redirects that leads to such a representation. Failure to provide access to such a representation implies that the origin server does not implement this protocol.</p>

        <p>This specification defines a JSON file named <code>tdmrep.json</code>, which MUST be hosted in the <code>/.well-known</code> repository of a Web server.</p>
        
        <p>This file contains an array of JSON objects; each object represents a rule and contains three properties:</p> 

        <ul>
          <li><em>location</em>: a pattern matching the path of a set of files hosted on the server, associated with the sibling TDM properties.</li>
          <li><em>TDM-a</em>: the value of TDM-a associated with the current pattern.</li>
          <li><em>TDM-b</em>: the value of TDM-b associated with the current pattern.</li>
        </ul>

        <p>To evaluate if the URL of a Web resource is subject to a given pattern, a TDM Agent MUST match the paths inferred from the pattern against the URL. The matching SHOULD be case sensitive. The most specific match found MUST be used. The most specific match is the first in sequence.</p>

        <p>If a percent-encoded US-ASCII character is encountered in the URI, it MUST be unencoded prior to comparison, unless it is a reserved character in the URI as defined by RFC3986 or the character is outside the unreserved character range.  The match evaluates positively if and only if the end of the path from the rule is reached before a difference in octets is encountered.</p>

				<div class="note">
          <p>A TDM Agent SHOULD keep in cache the unmarshaled resource and check the rules it contains against every Web resource it fetches from the origin server, <em>unless</em> this resource contains a TDM Header Field (see below).</p>
        </div>
      
        <section id="sec-tdm-file-regexp">

          <h3>Use of regular expressions</h3>

          <p>There are many variants of regular expressions. In order to simplify the work of TDM Agents, this specification is re-using the specification and wording of the <a href="https://tools.ietf.org/html/draft-koster-rep-00#section-2.2.3">robots.txt draft-koster-rep-00 2.2.3</a>.</p>

          <p>TDM Agents MUST allow the following special characters:</p>

          <table class="simple">
            <tr><th>Character</th>
                <th>Description</th>
                <th>Example</th>
            </tr>
            <tr><td>"$"</td>
                <td>Designates the end of the match pattern. A URI MUST end with a $.</td>
                <td>"TDM-b: /this/path/exactly$"</td>
            </tr>
            <tr><td>"*"</td>
                <td>Designates 0 or more instances of any character.</td>
                <td>"TDM-b: /this/*/then"</td>
            </tr>
          </table>
  
          <p>If TDM Agents match special characters verbatim in the URI, they MUST use "%" encoding.  For example:</p>

          <table class="simple">
            <tr><th>Pattern</th>
                <th>URI</th>
            </tr>
            <tr><td>/path/foo-%24</td>
                <td>https://www.example.com/path/foo-$</td>
            </tr>
          </table>

        </section>

        <section class="informative" id="sec-tdm-file-example">

          <h3>Example</h3>

          <p>Let’s imagine that a Web server is hosting three groups of files. The rightsholder of the first group of files (PDF documents) wants to express that TDM rights are reserved on this content. The rightsholder of the two other groups of files wants to express that TDM rights are tied to a license for the second group (html pages) and TDM rights are not reserved for the third (JPEG images).</p>

          <p>In this example, the first group is a set of files stored in /directory-a; the second group is stored in /directory-b/html and the third group in /directory-b/images.</p>

          <p>tdmrep.json is therefore structured as:</p> 

          <pre class="example">
          [
            {
            "location": "/directory-a",
            "TDM-a": 1
            },
            {
            "location": "/directory-b/html",
            "TDM-a": 2,
            "TDM-b":"https://example.com/policies/policy-a"
            },
            {
            "location": "/directory-b/images/*.jpg",
            "TDM-a": 0
            }
          ]
          </pre>

          <p>Note: in this example, if non-JPEG files are also located in “/directory-b/images”, their TDM status is by default controlled by the TDM exception of the DSM.</p> 

        </section>

      </section>

      <section id="sec-tdm-header">

        <h2>TDM Header Field for HTTP Requests</h2>

        <p>The TDM header field is a mechanism for declaring a choice in an HTTP request ([[RFC7230]]).</p>
        <p>This is the first thing a TDM Agent MUST check when it fetches a Web resource. The values found in this header supercede any value present in a TDM file on the origin server.</p>

        <pre class="abnf">
        TDM-declaration  = "TDM-a"
        TDM-field-value = ( "0" / "1" / "2" )
        </pre>

        <p>In the following example, the server returns a TDM-a header field with value <code>1</code>.
        <pre class="example">
        GET /something/here HTTP/1.1
        Host: example.com
        TDM-a: 1
        </pre>

        <p>In the following example, the server returns a TDM-a header field with value <code>2</code>, and a TDM-b header field with a URL as a value.</p>
        <pre class="example">
        GET /something/here HTTP/1.1
        Host: example.com
        TDM-a: 1
        TDM-b: https://something/policies/policy-a
        </pre>

        <p>The TDM Agent can then fetch the resource corresponding to the policy.<p> 

        <pre>
        GET /policies/policy-a HTTP/1.1
        Host: http://example.com 
        </pre>

        <p>The message returned by the Web server to the TDM Agent may indicate that the information is human readable:</p> 

        <pre>
        HTTP/1.1 200 OK
        Content-Type: text/html
        </pre>

        <p>Or it may indicate that the information is machine-readable:</p>

        <pre>
        HTTP/1.1 200 OK
        Content-Type: application/ld+json
        </pre>

      </section>

      <section id="sec-tdm-html-meta">

        <h2>TDM Metadata in HTML Content</h2>

        <p>TDM Metadata in HTML Content is a mechanism for declaring a choice when the previous mechanisms are not practical for a rightsholder.</p>
        <p>TDM Metadata are checked only if no TDM declaration has been found, either in a TDM header field or from rules expressed in a TDM file stored on the origin server.</p>

        <p>...</p>

		  </section>

    </section>

	</body>
</html>
